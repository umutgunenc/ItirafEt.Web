@page "/register"

<div class="position-absolute top-50 start-50 translate-middle w-100">
	<div class="row mx-0">
		<div class="col-lg-8 mx-auto my-auto border shadow-lg p-4 rounded">

			<div class="mt-3">
				<h1 class="text-center h3">Kayıt Ol</h1>
			</div>
			<hr />

			<EditForm Model="_registerModel"
					  OnValidSubmit="RegisterAsync">
				<DataAnnotationsValidator />

				<div class="my-3">
					<label class="form-label">Kullanıcı Adı:</label>
					<InputText @bind-Value="_registerModel.UserName" class="form-control" />
					<ValidationMessage For="()=> _registerModel.UserName" />
				</div>

				<div class="my-3">
					<label class="form-label">E-Posta:</label>
					<InputText @bind-Value="_registerModel.Email" type="email" class="form-control" />
					<ValidationMessage For="()=> _registerModel.Email" />
				</div>

				<div class="my-3">
					<label class="form-label">Şifre:</label>
					<div class="input-group">
						<InputText @bind-Value="_registerModel.Password"
								   class="form-control"
								   type="@(_showPassword ? "text" : "password")" />
						<button type="button" class="btn btn-outline-secondary" @onclick="TogglePasswordVisibility">
							<i class="@(_showPassword ? "bi bi-eye-slash" : "bi bi-eye")"></i>
						</button>
					</div>
					<ValidationMessage For="()=> _registerModel.Password" />
				</div>

				<div class="my-3">
					<label class="form-label">Şifre (Tekrar):</label>
					<div class="input-group">
						<InputText @bind-Value="_registerModel.PasswordConfirm"
								   class="form-control"
								   type="@(_showPasswordConfirm ? "text" : "password")" />
						<button type="button" class="btn btn-outline-secondary" @onclick="TogglePasswordConfirmVisibility">
							<i class="@(_showPasswordConfirm ? "bi bi-eye-slash" : "bi bi-eye")"></i>
						</button>
					</div>
					<ValidationMessage For="()=> _registerModel.PasswordConfirm" />
				</div>

				<div class="form-check mb-3">
					<InputCheckbox @bind-Value="_registerModel.isTermsAccepted" class="form-check-input" />
					<label class="form-check-label">
						<small>Sözleşmeyi ve Gizlilik Politikasını okudum, kabul ediyorum.</small>
					</label>

					<ValidationMessage For="()=> _registerModel.isTermsAccepted" />
				</div>

				@if (_errorMessage != null)
				{
					<div class="mb-3 text-bg-danger text-white p-2 rounded">
						<p class="mb-0">@_errorMessage</p>
					</div>
				}

				<div class="d-grid mb-3">
					@if (!_isBusy)
					{
						<button type="submit" class="btn btn-custom text-white">Kayıt Ol</button>
					}
					else
					{
						<button class="btn btn-custom text-white" type="button" disabled>
							<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
							Kayıt İşlemi Devam Ediyor
						</button>
					}
				</div>
			</EditForm>

			<hr />

			<div class="row mb-3 justify-content-center">
				<button type="button" class="btn btn-google w-100 mb-2">
					<i class="bi bi-google"></i> Google ile Kayıt Ol
				</button>
				<button type="button" class="btn btn-facebook w-100">
					<i class="bi bi-facebook"></i> Facebook ile Kayıt Ol
				</button>
			</div>

			<div class="text-center">
				<small>Zaten hesabınız var mı? <a href="/login">Giriş Yap</a></small>
			</div>

		</div>
	</div>
</div>

@code {
	private RegisterDto _registerModel = new();
	private bool _showPassword = false;

	private bool _isBusy;
	private bool _showPasswordConfirm;
	private string? _errorMessage;
	private void TogglePasswordVisibility()
	{
		_showPassword = !_showPassword;
	}
	private void TogglePasswordConfirmVisibility()
	{
		_showPasswordConfirm = !_showPasswordConfirm;
	}
	private async Task HandleValidSubmit()
	{
		_isBusy = true;
		_errorMessage = null;
		try
		{
			await RegisterAsync();
		}
		catch (Exception ex)
		{
			_errorMessage = ex.Message;
		}
		finally
		{
			_isBusy = false;
		}
	}


	private async Task RegisterAsync()
	{
		await Task.Delay(1000);

	}

}
